{{- if and .Values.launchpad.enabled .Values.launchpad.certificateManager.enabled -}}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: tls-internal-crt-launchpad
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: {{ .Chart.Name }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    app.kubernetes.io/version: {{ .Chart.AppVersion }}
spec:
  secretName: {{ .Values.launchpad.tls.internal.secretName }}
  duration: {{ .Values.launchpad.certificateManager.duration | quote }}
  renewBefore: {{ .Values.launchpad.certificateManager.renewBefore | quote }}
  {{- if or (not .Values.launchpad.certificateManager.commonName) (eq (len .Values.launchpad.certificateManager.commonName) 0) }} 
  commonName: {{ (include "launchpad.host" .) | quote }}
  isCA: false
  privateKey: 
    algorithm: RSA
    encoding: PKCS1
    size: 2408
  dnsNames: 
  - {{ (include "launchpad.host" .) | quote }}
  {{- else }}
  commonName: {{ .Values.launchpad.certificateManager.commonName }}
  dnsNames: {{ .Values.launchpad.certificateManager.dnsNames }}
  {{- end }}
  issuerRef:
    name: {{ .Values.launchpad.certificateManager.issuerRef.name }} 
    kind: ClusterIssuer
{{- end}}
{{- if and .Values.stardog.enabled .Values.stardog.certificateManager.enabled }}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: tls-internal-crt-stardog
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: {{ .Chart.Name }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    app.kubernetes.io/version: {{ .Chart.AppVersion }}
spec:
  secretName: {{ .Values.stardog.tls.internal.secretName }}
  duration: {{ .Values.stardog.certificateManager.duration | quote }}
  renewBefore: {{ .Values.stardog.certificateManager.renewBefore | quote }}
  {{- if or (not .Values.stardog.certificateManager.commonName) (eq (len .Values.stardog.certificateManager.commonName) 0) }}
  commonName: {{ (include "stardog.host" .) | quote }}
  isCA: false
  privateKey: 
    algorithm: RSA
    encoding: PKCS1
    size: 2408
  dnsNames:
  - {{ (include "stardog.host" . ) | quote }}
  {{- else }}
  commonName: {{ .Values.stardog.certificateManager.commonName }}
  dnsNames: {{ .Values.stardog.certificateManager.dnsNames }}
  {{- end }}
  issuerRef:
    name: {{ .Values.stardog.certificateManager.issuerRef.name }}
    kind: ClusterIssuer
{{- end}}
